---
title: "data_analysis_working"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

# Which packages will I need for this program? 

library(tidyverse)
library(tidycensus)
library(janitor)
library(mapview)
library(ggthemes)
library(scales)
library(arcos)
library(stringr)

```

```{r}
# What keys will I need for this program? 
# KEYS
census_api_key("6807e6be8b6aeed023ebd2791acda76a66b32754")
arcos_key <- "aoQ1LGl"

```

```{r}

# How do you locate variables in the ACS data? 
#CENSUS DATA VARIABLES 
acs_variables <- load_variables(2012, "acs5", cache = TRUE)

# The answer is there is no easy way to find variables in the ACS data. Search around online or use trial and error. There's your answer, Meghan. 

```

```{r}

# What is the county geodata?
#GEODATA OF COUNTIES 
county_geodata_shifted <- get_acs(geography = "county",
              variables = "B01001_001", geometry = TRUE, shift_geo = TRUE)

# The county geodata stores the geographic location of the county for mapping and visualization. 

```

```{r}

# What is the state geodata? 
#GEODATA OF STATES 
state_geodata_shifted <- get_acs(geography = "state",
              variables = "B01001_001", geometry = TRUE, shift_geo = TRUE)

```

```{r}

# What is the median household income in each county across the United States? 

#MEDIAN HOUSEHOLD INCOME IN COUNTIES ACROSS U.S. 
nat_counties_median_income <- get_acs(geography = "county", variables = c("B19013_001"), survey="acs5", year = 2012)

# Obviously I can't list the median income for each county in the entire country, but I did organize it into this neat little chart. 

```


```{r}

#What is the median household income in each county in Maryland? 

# MARYLAND COUNTIES MEDIAN HOUSEHOLD INCOME 
MD_C_median_income <- nat_counties_median_income %>%
  filter(str_detect(NAME, "Maryland"))

# Answers are stored in this little chart. 
```

```{r}

# Which state has the highest median income?

#STATES MEDIAN HOUSEHOLD INCOME 
state_median_income <- get_acs(geography = "state", variables = "B19013_001", year = 2012) %>%
  arrange(desc(estimate))

# Maryland has the highest median income. 
```

```{r}

# Which county in Maryland received the most pills per person between 2006 and 2012? 

summarized_county_annual(state="MD", key = arcos_key) %>%
  group_by(BUYER_COUNTY) %>%
  summarise(DOSAGE_UNIT = sum(DOSAGE_UNIT)) %>%
  arrange(desc(DOSAGE_UNIT))

# Baltimore County received the most pills per person between 2006 and 2012. 
```

```{r}

# Which county in the United States received the most pills total between 2006 and 2012?

county_raw(key = arcos_key)

```


```{r}

# How do I build a chart that contains both the median income and the pills received? 

MD_C_annual_pills <- summarized_county_annual(state="MD", key=arcos_key) 



############# How do I add Baltimore City back in? 
income_per_county <- bind_cols(maryland_median_incomes_county, total_maryland_county_pills_2012) %>%
  select(GEOID, BUYER_COUNTY, estimate, total_pills) %>%
  add_row(GEOID = 24510, BUYER_COUNTY = "BALTIMORE CITY", estimate = 40803, total_pills = 20673130)
```

```{r}

########### Which county has the highest median income? 

income_per_county %>%
  arrange(desc(estimate))

income_per_county %>%
  arrange(desc(total_pills))

rm(baltimore_city)
########### What does a bar graph of this look like? 
ggplot(income_per_county) + 
  geom_bar(stat="identity", aes(estimate, total_pills, fill= BUYER_COUNTY, width = 800)) +
  scale_y_continuous(labels=comma)  + scale_x_continuous(labels=comma)


```

