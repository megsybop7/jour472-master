---
title: "data_analysis_working"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

############ Which packages will I need for this program? 

library(tidyverse)
library(tidycensus)
library(janitor)
library(mapview)
library(ggthemes)
library(scales)
library(arcos)
library(stringr)

```

```{r}

############# What keys will I need for this program? 

#KEYS
census_api_key("6807e6be8b6aeed023ebd2791acda76a66b32754")
arcos_key <- "aoQ1LGl"

############# How do you locate variables in the ACS data? 

#CENSUS DATA VARIABLES 
acs_variables <- load_variables(2012, "acs5", cache = TRUE)

############ What is the county geodata?

#GEODATA OF COUNTIES 
county_geodata_shifted <- get_acs(geography = "county",
              variables = "B01001_001", geometry = TRUE, shift_geo = TRUE)

########### What is the state geodata? 
#GEODATA OF STATES 
state_geodata_shifted <- get_acs(geography = "state",
              variables = "B01001_001", geometry = TRUE, shift_geo = TRUE)

############ What is the median household income in each county across the United States? 
#MEDIAN HOUSEHOLD INCOME IN COUNTIES ACROSS U.S. 
county_median_household_income <- get_acs(geography = "county", variables = c("B19013_001"), survey="acs5", year = 2012)
view(county_median_household_income)


############# What is the median household income in each county in Maryland? 
#MARYLAND COUNTIES MEDIAN HOUSEHOLD INCOME 
maryland_median_incomes_county <- county_median_household_income %>%
  filter(str_detect(NAME, "Maryland"))


############## What is the median household income in each state? 
#STATES MEDIAN HOUSEHOLD INCOME 
state_income <- get_acs(geography = "state", variables = "B19013_001")

############### Which county in Maryland received the most pills per person between 2006 and 2012? 
total_maryland_county_pills_2012 <- maryland_counties_pills_per_year %>%
  summarise(total_pills = sum(DOSAGE_UNIT))

```


```{r}

############# Who received most pills relative to the median income? 
maryland_median_incomes_county <- maryland_median_incomes_county %>%
  filter(NAME !="Baltimore city, Maryland")

total_maryland_county_pills_2012 <- total_maryland_county_pills_2012 %>%
  filter(BUYER_COUNTY != "BALTIMORE CITY")

baltimore_city <- summarized_county_annual(county = "Baltimore City", state = "MD", key = arcos_key)

############# How do I add Baltimore City back in? 
income_per_county <- bind_cols(maryland_median_incomes_county, total_maryland_county_pills_2012) %>%
  select(GEOID, BUYER_COUNTY, estimate, total_pills) %>%
  add_row(GEOID = 24510, BUYER_COUNTY = "BALTIMORE CITY", estimate = 40803, total_pills = 20673130)
```

```{r}

########### Which county has the highest median income? 

income_per_county %>%
  arrange(desc(estimate))


income_per_county %>%
  arrange(desc(total_pills))

########### What does a bar graph of this look like? 
ggplot(income_per_county) + 
  geom_bar(stat="identity", aes(estimate, total_pills, fill= BUYER_COUNTY, width = 800)) +
  scale_y_continuous(labels=comma)  + scale_x_continuous(labels=comma)


```

